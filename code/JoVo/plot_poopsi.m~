function plot_poopsi(V,smc)

% given new inference for each neuron, update parameters

for i=1:V.Ncells
    EE{i}    = smc{i}.P;
end
    
Phat.omega = GetMatrix(V.Ncells,EE);
% PlotMatrix(smc,V,smc{1}.P,Phat)

% % print fig
% wh=[7 5];   %width and height
% set(fig,'PaperPosition',[0 11-wh(2) wh]);
% print('-depsc','VConnector')
% print('-dpdf','VConnector')

end

function omega = GetMatrix(Nc,P)

omega=zeros(Nc);
for i=1:Nc
    omega(i,i)=P{i}.omega;
    Pre=1:Nc;                                       % generate list of presynaptic neurons
    Pre(Pre==i)=[];                                 % remove self
    k=0;                                            % counter of dimension
    for j=Pre
        k=k+1;                                      % generate input to neuron based on posterior mean spike train from neuron j
        omega(i,j)=P{i}.k(k+1);
    end
end

end

% function PlotMatrix(D,V,P,Phat)
% 
% fig=figure(5); clf,
% col = jet(V.Ncells);          % define colors for mean
% 
% tstart=2/V.dt;
% tdt=1/V.dt;
% tend = min(tstart+8*tdt,V.T);
% subplot(2,3,[1 2 3]), hold on
% for i=1:V.Ncells
% %     plot(((smc{i}.F)./max(smc{i}.F))+1,'Color',col(i,:));
% end
% axis('tight'),
% xticks  = tstart:tdt:tend;               % XTick positions
% set(gca,'YTick',[],'YTickLabel',[])
% set(gca,'XTick',xticks,'XTickLabel',xticks*V.dt)
% ylabel('Fluorescence')
% xlabel('Time (sec)')
% 
% clims(1)=min([P.omega(:)' Phat{1}.omega(:)' Phat{2}.omega(:)']);
% clims(2)=max([P.omega(:)' Phat{1}.omega(:)' Phat{2}.omega(:)']);
% subplot(234), imagesc(P.omega,clims), colormap(gray),
% set(gca,'XTick',[1:V.Ncells],'YTick',[1:V.Ncells]) %colorbar
% title('True matrix')
% ylabel('Presynaptic'), xlabel('Postsynaptic')
% 
% subplot(235), imagesc(Phat{1}.omega,clims), %colorbar
% set(gca,'XTick',[1:V.Ncells],'YTick',[1:V.Ncells]) %colorbar
% title('Matrix from spikes')
% 
% subplot(236), imagesc(Phat{2}.omega,clims), %colorbar
% set(gca,'XTick',[1:V.Ncells],'YTick',[1:V.Ncells]) %colorbar
% title('Matrix from fluorescence')
% 
% % print fig
% wh=[7 5];   %width and height
% set(fig,'PaperPosition',[0 11-wh(2) wh]);
% print('-depsc','VConnector')
% print('-dpdf','VConnector')
% 
% end