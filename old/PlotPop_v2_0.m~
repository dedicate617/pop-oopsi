clf, clc, clear
fig=figure(5); 
col = [0 0 0; .75 .75 .75; 0 0 0; 1 0.5 0; 1 0 1];          % define colors for mean
ls{1} = '-'; ls{2} =  '-'; ls{3} = '-.';

Ts=[ 10000 10000];

fnames{1}=['SimConnector', num2str(Ts(1)), '_5_3.mat'];
fnames{2}=['SimConnector', num2str(Ts(2)), '_10_1.mat'];
fnames{3}=['SimConnector', num2str(Ts(3)), '_20_1.mat'];

ylabs{1}='~500 sp/neuron';
ylabs{2}='~600 sp/neuron';
ylabs{3}='~600 sp/neuron';

ticks{1}=1:5;
ticks{2}=2:2:10;
ticks{3}=4:4:20;

% nmean=0;
% for j=1:Sim.Nc,
%     nmean=nmean+sum(S(j).n);
% end
% nmean=nmean/Sim.Nc;

load(fnames{1})
tstart=2/Sim.dt;
tdt=1/Sim.dt;
tend = tstart+4*tdt;

Ts(3)=[];
nrows=numel(Ts)+1;
subplot(nrows,3,[1 2 3]), hold on
for i=1:2
    plot(z1(S(i).F(tstart:tend))+1,'Color',col(i,:),'LineStyle',ls{i});
    bar(S(i).n(tstart:tend),'EdgeColor',col(i,:),'FaceColor',col(i,:))
end
axis('tight'),
xticks  = tstart:tdt:tend;               % XTick positions
set(gca,'YTick',[],'YTickLabel',[])
set(gca,'XTick',xticks-tstart,'XTickLabel',(xticks-tstart)*Sim.dt)
ylabel([{'Fluorescence'};{'and spikes'}])
xlabel('Time (sec)')

clims=[inf -inf];
for i=1:numel(Ts)
    load(fnames{i})
    clims(1)=min([clims(1) P.omega(:)' Phat{1}.omega(:)' Phat{2}.omega(:)']);
    clims(2)=max([clims(2) P.omega(:)' Phat{1}.omega(:)' Phat{2}.omega(:)']);
end

for i=1:numel(Ts)
    load(fnames{i})
    subplot(nrows,3,3*i+1), imagesc(P.omega,clims), colormap(gray),
    set(gca,'XTick',[],'YTick',[])
    if i==nrows-1, title('True matrix'), end
    ylab=ylabel(ylabs{i});

    subplot(nrows,3,3*i+2), imagesc(Phat{1}.omega,clims), %colorbar
    set(gca,'XTick',[],'YTick',[])
    if i==nrows-1, title('Matrix from spikes'), end
    % ylabel('Presynaptic'), xlabel('Postsynaptic')

    subplot(nrows,3,3*i+3), imagesc(Phat{2}.omega,clims), %colorbar
    set(gca,'XTick',[],'YTick',[])
    if i==nrows-1, 
        title('Matrix from fluorescence'), 
        ylabel('Presynaptic'), 
        xlabel('Postsynaptic'), 
    end
    set(gca,'XTick',ticks{i},'YTick',ticks{i})
    
    % ylabel('Presynaptic'), xlabel('Postsynaptic')
end

%% print fig
wh=[7 6];   %width and height
set(fig,'PaperPosition',[0 11-wh(2) wh]);
print('-depsc','SimConnector2')
print('-dpdf','SimConnector2')
